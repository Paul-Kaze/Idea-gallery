---
name: feature-improvement-prd
description: "基于项目现有代码结构，通过逐模块迭代式追问生成功能改进PRD。输出为统一的功能需求表格（一级/二级/三级功能+多条需求描述+优先级）。触发词: 功能改进, feature improvement prd, 需求分析, 功能优化, 改进需求文档"
---

# Feature Improvement PRD Generator

基于项目现有代码结构，通过**逐模块、小步迭代**的追问方式生成功能改进 PRD（Product Requirements Document）。核心目标是深入理解项目现状后，帮助用户厘清功能改进的完整需求。

---

## The Job

1. **分析项目结构** — 扫描项目目录、读取关键文件，理解技术栈和架构
2. **接收功能改进方向** — 用户描述想要改进或新增的功能方向
3. **逐模块迭代追问（核心）** — 每次聚焦一个功能模块，少量提问，持续循环
4. **先出草稿再完善** — 信息差不多时先输出草稿 PRD，再根据用户反馈迭代完善
5. **生成功能需求表格** — 输出统一大表格的功能需求 PRD

**重要：** 仅生成需求文档，不要开始实现代码。

---

## Step 1: 项目结构分析

在开始提问之前，**必须先深入分析项目的现有结构**。

### 分析范围

使用工具扫描并理解以下内容：

1. **项目根目录结构** — 了解整体布局（前端/后端/公共模块等）
2. **技术栈** — 通过 `package.json`、`requirements.txt`、`go.mod` 等识别框架和依赖
3. **目录架构** — 识别各模块/组件/服务的划分方式
4. **API 路由** — 扫描 API 端点定义
5. **现有功能模块** — 识别已有功能的组件/页面/服务
6. **配置文件** — 理解环境配置、部署配置等

### 分析输出

分析完成后，向用户展示你理解的项目概况：

```
## 项目结构概览

**技术栈：** Next.js + TypeScript + Prisma + PostgreSQL
**前端模块：** pages/, components/, hooks/
**后端模块：** api/, services/, lib/
**现有功能：**
- 用户系统（注册/登录/个人中心）
- 内容管理（创建/编辑/删除文章）
- 评论系统
- 标签分类

请确认以上理解是否正确，然后告诉我您想改进或新增的功能方向。
```

---

## Step 2: 逐模块迭代追问（核心环节）

收到用户的功能改进方向后，进行**逐模块、小步快跑**的追问。

### 追问原则（重要！严格遵守！）

1. **每次只聚焦一个功能模块** — 不要一次性覆盖多个模块，先搞清楚一个再推进下一个
2. **每轮只提 1-3 个问题** — 问题少而精，降低用户回复负担
3. **持续循环迭代** — 一个模块问完后，自然过渡到下一个模块继续追问
4. **问题必须与项目现有结构关联** — 引用实际的模块名、组件名、API 路径
5. **发现复杂点时原地深挖** — 不急于跳到下一个模块

### 追问节奏

按以下节奏推进，每一步都是一轮独立的对话：

#### 节奏 1：先确认功能入口和定位（1-2 个问题）
- 这个功能在项目中的入口在哪里？
- 与现有的 [具体组件/页面] 是什么关系？

#### 节奏 2：聚焦模块 A 的核心交互（1-3 个问题）
- [模块 A] 的核心操作流程是怎样的？
- 用户的输入/输出分别是什么？

#### 节奏 3：聚焦模块 B 的核心交互（1-3 个问题）
- [模块 B] 的具体行为是什么？
- 与 [模块 A] 如何联动？

#### 节奏 4+：继续下一个模块，或深入补充（1-2 个问题）
- 根据前面回答中暴露的模糊点继续追问
- 确认边界条件、异常处理等

### 追问格式

```
关于 **[当前聚焦的模块名称]**，我需要确认：

1. [具体问题]？
   A. 选项 A
   B. 选项 B
   C. 其他: [请说明]
```

### 适时输出草稿 PRD 的时机

当满足以下条件时，**先输出一份草稿 PRD**，然后继续询问用户意见进行完善：

- 已了解了大部分功能模块的核心交互
- 能够初步划分出一级/二级/三级功能层级
- 还有一些细节未确认，但不影响整体框架

**草稿输出后，继续向用户提问：**
```
以上是基于目前信息的草稿 PRD，请看看：
1. 是否有遗漏的功能模块？
2. 哪些需求描述需要调整或补充？
3. 优先级排序是否合理？
```

根据用户反馈继续迭代完善，直到用户确认满意。

### 完整性检查清单

在最终定稿前，内部检查以下条件（不需要全部展示给用户）：

- [ ] **功能目标清晰** — 明确知道改进要达成什么效果
- [ ] **功能层级完整** — 已识别出所有一级、二级、三级功能
- [ ] **每个功能有多条需求描述** — 大部分功能包含多条具体需求
- [ ] **优先级已确认** — 每个功能点的优先级已确定
- [ ] **与现有系统的关系清晰** — 知道涉及哪些模块的修改/新增
- [ ] **边界条件已定义** — 知道功能范围和不做的内容
- [ ] **异常场景已考虑** — 识别了主要的异常和边界情况

---

## Step 3: 生成功能改进 PRD

### PRD 结构

```markdown
[PRD]
# 功能改进 PRD: [功能名称]

## 1. 改进概述
简要描述本次功能改进的背景、目标和预期效果。

## 2. 改进目标
- 目标 1
- 目标 2
- ...

## 3. 涉及的现有模块
列出本次改进涉及的项目现有模块/组件/服务，以及各自的变更类型（新增/修改/删除）。

| 模块/组件 | 路径 | 变更类型 | 变更说明 |
|----------|------|---------|---------| 
| UserService | src/services/user.ts | 修改 | 新增用户偏好设置接口 |
| SettingsPage | src/pages/settings.tsx | 新增 | 新建设置页面组件 |

## 4. 功能需求明细

**所有功能需求在一张统一的大表格中呈现。** 每个功能通常包含多条需求描述行。

| 一级功能 | 二级功能 | 三级功能 | 需求具体描述 | 优先级 |
|---------|---------|---------|------------|-------|
| 用户管理 | 注册 | 邮箱注册 | 用户可通过邮箱+密码完成账号注册 | P0 |
| 用户管理 | 注册 | 邮箱注册 | 注册时需验证邮箱格式，密码长度不少于 8 位 | P0 |
| 用户管理 | 注册 | 邮箱注册 | 注册成功后发送验证邮件，用户需点击链接激活账号 | P1 |
| 用户管理 | 注册 | 邮箱注册 | 邮箱已被注册时展示提示信息并引导登录 | P0 |
| 用户管理 | 登录 | 密码登录 | 用户可通过邮箱+密码完成登录 | P0 |
| 用户管理 | 登录 | 密码登录 | 连续 5 次登录失败后锁定账号 15 分钟 | P1 |
| ... | ... | ... | ... | ... |

> 注：层级可按需扩展（四级功能、五级功能...）以适应功能复杂度。
> 优先级说明：P0 = 必须实现 / P1 = 应该实现 / P2 = 可选实现
> **重要：** 同一个三级功能通常对应多条需求描述行，每条描述一个具体的需求点或规则。

## 5. 非功能性需求
- 性能要求
- 安全要求
- 兼容性要求

## 6. 不在范围内（Non-Goals）
明确列出本次改进不包含的内容。

## 7. 待确认事项
仍需进一步确认或后续迭代中处理的问题。

[/PRD]
```

### 功能需求表格填写规则

1. **一级功能** — 顶层功能模块（如：用户管理、内容管理、通知系统）
2. **二级功能** — 一级功能下的子功能（如：注册登录、个人设置）
3. **三级功能** — 更细粒度的功能点（如：邮箱注册、手机注册）
4. **需求具体描述** — 清晰、无歧义的需求说明，使用动宾结构（如："用户可通过邮箱+密码完成账号注册"）
5. **优先级** — P0（必须实现）/ P1（应该实现）/ P2（可选实现）

**关键规则：**
- **每个功能（尤其是三级功能）大部分需要包含多条需求描述行**
- 每条需求描述只描述一个具体的需求点、规则或交互行为
- 通过重复一级/二级/三级功能列的值，来关联同一功能下的多条需求
- **避免一个功能只有一行笼统描述** — 应拆解为多个具体、可验证的需求条目

**层级扩展规则：**
- 当三级功能仍然过于宏观时，添加四级功能列
- 当四级功能仍需细分时，添加五级功能列
- 表格列数根据实际功能复杂度动态调整

---

## Example Conversation Flow

**User:** 我想改进项目的图片管理功能

**Assistant:** 好的，让我先分析一下项目结构...

[扫描项目目录、读取关键文件]

## 项目结构概览

**技术栈：** Next.js 14 + TypeScript + Supabase + TailwindCSS
**前端模块：** app/, components/, hooks/, stores/
**后端：** Supabase (Auth + Database + Storage)
**现有功能：**
- 用户认证（Supabase Auth）
- 图片上传与存储（Supabase Storage）
- 图片展示画廊
- 基础标签系统

请确认以上理解是否正确。然后请告诉我，您想改进图片管理的哪些方面？

**User:** 对的，我想增加图片分类和批量操作功能

**Assistant:** 明白了。先聊聊 **图片分类** 这个模块：

1. 分类的组织方式是？
   A. 基于现有的 `tags` 表扩展，使用标签作为分类
   B. 新建独立的 `categories` 分类体系（支持层级）
   C. 两者结合 — 分类 + 标签

**User:** B

**Assistant:** 好的，独立分类体系。那关于 **分类层级**：

1. 分类层级的深度是？
   A. 一级分类即可（如：风景、人物、建筑）
   B. 两级分类（如：风景 > 山景、风景 > 海景）
   C. 三级或更多

**User:** B

**Assistant:** 两级分类。关于 **图片与分类的归属关系**：

1. 每张图片可以属于多少个分类？
   A. 只能属于一个分类
   B. 可以属于多个分类

**User:** B

**Assistant:** 好的。接下来聊聊 **批量操作** 这块：

1. 批量操作具体需要哪些？
   A. 批量删除
   B. 批量移动到分类
   C. 批量修改标签
   D. 以上全部

**User:** D

**Assistant:** 全部都要。关于 **批量选择的交互**：

1. 选择方式偏好？
   A. 复选框多选
   B. 全选/反选 + 复选框
   C. 框选（拖拽区域）

**User:** B

**Assistant:** 好的，目前收集的信息差不多了，让我先输出一份草稿 PRD：

[PRD]
# 功能改进 PRD: 图片分类与批量操作

## 1. 改进概述
为图片管理系统新增独立的两级分类体系和批量操作功能...

## 4. 功能需求明细

| 一级功能 | 二级功能 | 三级功能 | 需求具体描述 | 优先级 |
|---------|---------|---------|------------|-------|
| 分类管理 | 分类创建 | 一级分类 | 用户可创建顶级分类（如：风景、人物） | P0 |
| 分类管理 | 分类创建 | 一级分类 | 分类名称不可为空，最大 20 字符 | P0 |
| 分类管理 | 分类创建 | 一级分类 | 分类名称不可重复，重复时提示用户 | P0 |
| 分类管理 | 分类创建 | 二级分类 | 用户可在一级分类下创建子分类 | P0 |
| 分类管理 | 分类创建 | 二级分类 | 同一一级分类下的子分类名称不可重复 | P0 |
| 分类管理 | 分类编辑 | 重命名 | 用户可修改已有分类的名称 | P0 |
| 分类管理 | 分类编辑 | 删除 | 用户可删除空分类（无图片归属时） | P0 |
| 分类管理 | 分类编辑 | 删除 | 删除含图片的分类时提示用户先移除图片 | P0 |
| 分类管理 | 默认分类 | 未分类 | 系统自动创建"未分类"默认分类，不可删除 | P0 |
| 分类管理 | 默认分类 | 未分类 | 新上传且未指定分类的图片自动归入"未分类" | P0 |
| 图片分类 | 分类归属 | 单张分类 | 用户可将图片归属到一个或多个分类 | P0 |
| 图片分类 | 分类归属 | 单张分类 | 在图片详情/右键菜单中提供"设置分类"入口 | P0 |
| 图片分类 | 分类浏览 | 筛选视图 | 用户可按分类筛选显示图片 | P0 |
| 图片分类 | 分类浏览 | 筛选视图 | 选中分类后，画廊仅展示该分类下的图片 | P0 |
| 批量操作 | 批量选择 | 全选/反选 | 提供全选和反选操作按钮 | P1 |
| 批量操作 | 批量选择 | 复选框 | 每张图片提供复选框用于多选 | P1 |
| 批量操作 | 批量选择 | 复选框 | 选中状态有明显视觉区分（如边框高亮） | P1 |
| 批量操作 | 批量删除 | - | 用户可批量删除选中的图片 | P1 |
| 批量操作 | 批量删除 | - | 删除前弹出二次确认弹窗 | P1 |
| 批量操作 | 批量标签 | - | 用户可批量修改选中图片的标签 | P1 |
| 批量操作 | 批量移动 | - | 用户可批量将图片移动到目标分类 | P1 |
| 批量操作 | 批量移动 | - | 移动时展示目标分类选择弹窗 | P1 |

...
[/PRD]

以上是草稿 PRD，请看看：
1. 是否有遗漏的功能模块？
2. 哪些需求描述需要调整或补充？
3. 优先级排序是否合理？

**User:** 整体差不多，分类管理的权限需要补充一下

**Assistant:** 好的，关于 **分类管理权限**：

1. 权限模式是？
   A. 所有用户都可以创建/编辑分类
   B. 用户管理自己的分类，管理员管理全局分类
   C. 仅管理员可管理分类

**User:** B

**Assistant:** 收到，我来更新 PRD，在表格中补充权限相关的需求行...

[更新后的完整 PRD]

---

## Checklist

在输出 PRD 之前，确认以下事项：

- [ ] 已完成项目结构分析，并向用户确认
- [ ] 每轮追问只聚焦一个模块，每次不超过 3 个问题
- [ ] 进行了持续迭代追问（至少 3 轮）
- [ ] 每轮追问都引用了项目中的实际模块/组件
- [ ] 在信息足够时先输出了草稿 PRD
- [ ] 根据用户反馈迭代完善了 PRD
- [ ] 所有功能点都有明确的一级/二级/三级分类
- [ ] 大部分功能包含多条需求具体描述（而非单行笼统描述）
- [ ] 所有功能点都标注了优先级（P0/P1/P2）
- [ ] 涉及的现有模块变更已列出
- [ ] Non-Goals 已定义清晰的边界
- [ ] PRD 已用 `[PRD]...[/PRD]` 标记包裹
