---
name: frd-generator
description: 生成功能需求文档 (FRD)。专注于功能规格、系统行为和逻辑，移除用户故事和高层目标。触发词：create an frd, write frd for, spec out functions, functional requirements for, 生成功能需求文档。
---

## 任务目标

1. 接收用户的功能/系统描述。
2. 询问 3-5 个关键的澄清问题，重点关注**逻辑、数据流和边界情况**。
3. **必须询问质量门禁 (Quality Gates)**（验证命令）。
4. 在每次回答后，如果需要，询问后续问题（自适应探索）。
5. 当你拥有足够的上下文时，生成结构化的 FRD。
6. 输出包裹在 `[FRD]...[/FRD]` 标记中的 FRD。

**重要：** 不要开始实施代码。只需创建 FRD。专注于系统**做什么**，而不是**为什么**（目标）或**谁**（用户故事）。

---

## 第一步：澄清问题 (迭代)

询问问题以揭示功能细节。关注点：

- **输入/输出：** 什么数据进入和离开系统？
- **逻辑/规则：** 适用什么具体算法或规则？
- **状态管理：** 系统状态如何变化？
- **错误处理：** 出错时会发生什么？
- **边界情况：** 空状态、限制或无效输入如何处理？
- **质量门禁：** 必须通过哪些命令？（必填）

### 问题格式示例：

```
1. 系统应如何处理 [字段] 的无效输入？
   A. 返回特定错误代码 (如 400)
   B. 抛出命名异常
   C. 静默忽略并使用默认值
   D. 其他：[请说明]

2. [功能] 的预期输出格式是什么？
   A. 具有特定架构的 JSON 对象
   B. 纯文本字符串
   C. 字节流
   D. 其他：[请说明]
```

### 质量门禁问题 (必填)

始终询问关于质量门禁的问题：

```
这些功能必须通过哪些质量命令？
   A. pnpm typecheck && pnpm lint
   B. npm run typecheck && npm run lint
   C. bun run typecheck && bun run lint
   D. 其他：[请指定您的命令]
```

---

## 第二步：FRD 结构

生成包含以下部分的 FRD：

### 1. 概述 (Overview)
功能的简要技术摘要。

### 2. 功能需求明细 (Functional Requirements)
**所有功能需求在一张统一的大表格中呈现。** 每个功能通常包含多条需求描述行。

| 一级功能 | 二级功能 | 三级功能 | 需求具体描述 | 优先级 |
|---------|---------|---------|------------|-------|
| 用户管理 | 注册 | 邮箱注册 | 用户可通过邮箱+密码完成账号注册 | P0 |
| 用户管理 | 注册 | 邮箱注册 | 注册时需验证邮箱格式，密码长度不少于 8 位 | P0 |
| 用户管理 | 注册 | 邮箱注册 | 注册成功后发送验证邮件，用户需点击链接激活账号 | P1 |
| 用户管理 | 注册 | 邮箱注册 | 邮箱已被注册时展示提示信息并引导登录 | P0 |
| 用户管理 | 登录 | 密码登录 | 用户可通过邮箱+密码完成登录 | P0 |
| 用户管理 | 登录 | 密码登录 | 连续 5 次登录失败后锁定账号 15 分钟 | P1 |
| ... | ... | ... | ... | ... |

> 注：层级可按需扩展（四级功能、五级功能...）以适应功能复杂度。
> 优先级说明：P0 = 必须实现 / P1 = 应该实现 / P2 = 可选实现
> **重要：** 同一个三级功能通常对应多条需求描述行，每条描述一个具体的需求点或规则。

### 3. 错误处理 (Error Handling)
列出具体的错误场景和所需的系统响应。
- **ERR-001:** 条件 -> 响应
- **ERR-002:** 条件 -> 响应

### 4. API / 接口规范 (API Specifications)
如果适用，定义端点、命令签名或公共方法。

### 5. 质量门禁 (Quality Gates)
**关键：** 列出必须通过的命令。

```markdown
## Quality Gates
- `pnpm typecheck`
- `pnpm lint`
- [其他命令]
```

---

## 实施指南

FRD 是编码的蓝图。
- 技术性要强，表述要精确。
- 在有帮助的地方使用伪代码或类型定义。
- 避免模糊的术语，如“适当的”、“合理的”或“用户友好的”。定义确切的值。

---

## 输出格式

**关键：** 将最终的 FRD 包裹在标记中：

```
[FRD]
# FRD: [功能/系统名称]

## 1. 概述
...

## 2. 功能需求明细
| 一级功能 | 二级功能 | 三级功能 | 需求具体描述 | 优先级 |
|---------|---------|---------|------------|-------|
...

## 3. 错误处理
...

## 4. API / 接口规范
...

## 5. 质量门禁
...
[/FRD]
```

**文件命名：** 系统将保存到 `./specs/frd-[name].md`（或类似的，可适应）。